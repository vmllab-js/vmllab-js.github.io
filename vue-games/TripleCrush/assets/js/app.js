(function(t){function e(e){for(var c,s,i=e[0],l=e[1],a=e[2],h=0,f=[];h<i.length;h++)s=i[h],Object.prototype.hasOwnProperty.call(o,s)&&o[s]&&f.push(o[s][0]),o[s]=0;for(c in l)Object.prototype.hasOwnProperty.call(l,c)&&(t[c]=l[c]);u&&u(e);while(f.length)f.shift()();return r.push.apply(r,a||[]),n()}function n(){for(var t,e=0;e<r.length;e++){for(var n=r[e],c=!0,i=1;i<n.length;i++){var l=n[i];0!==o[l]&&(c=!1)}c&&(r.splice(e--,1),t=s(s.s=n[0]))}return t}var c={},o={app:0},r=[];function s(e){if(c[e])return c[e].exports;var n=c[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=t,s.c=c,s.d=function(t,e,n){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},s.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var c in t)s.d(n,c,function(e){return t[e]}.bind(null,c));return n},s.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="";var i=window["webpackJsonp"]=window["webpackJsonp"]||[],l=i.push.bind(i);i.push=e,i=i.slice();for(var a=0;a<i.length;a++)e(i[a]);var u=l;r.push([0,"chunk-vendors"]),n()})({0:function(t,e,n){t.exports=n("56d7")},"11ad":function(t,e,n){},"4db9":function(t,e,n){"use strict";n("11ad")},"56d7":function(t,e,n){"use strict";n.r(e);n("e260"),n("e6cf"),n("cca6"),n("a79d");var c=n("2b0e"),o=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"app"}},[n("router-view")],1)},r=[],s=(n("5c0b"),n("2877")),i={},l=Object(s["a"])(i,o,r,!1,null,null,null),a=l.exports,u=n("8c4f"),h=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"home"},[n("div",{staticClass:"title"},[t._v("Trigle Crush")]),n("div",{staticClass:"score"},[t._v("Score: "+t._s(t.score))]),n("TrigleCurshGame",{ref:"game",on:{addScore:t.addScore,unsolvable:t.unsolvable}}),n("div",{staticClass:"btn-again",on:{click:t.playAgain}},[t._v("Play Again")])],1)},f=[],d=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"trigle-crush-game"},[n("div",{staticClass:"blocks"},[t._l(t.blocks,(function(e){return[n("div",{key:e.id,staticClass:"block",class:[e.status,!t.animating&&(t.answer[0]==e.x&&t.answer[1]==e.y||t.answer[2]==e.x&&t.answer[3]==e.y)?"answer":""],attrs:{x:e.x,y:e.y,color:e.color},on:{touchstart:function(n){var c=arguments.length,o=Array(c);while(c--)o[c]=arguments[c];return t.onTouchStart.apply(void 0,[e].concat(o))},touchmove:function(n){var c=arguments.length,o=Array(c);while(c--)o[c]=arguments[c];return t.onTouchMove.apply(void 0,[e].concat(o))}}})]}))],2)])},_=[],p=(n("d3b7"),n("159b"),n("3ca3"),n("ddb0"),n("d81d"),n("a434"),n("4e82"),n("4de4"),7),v=7,g={name:"TrigleCurshGame",props:{},data:function(){return{animating:!1,cells:[],blocks:[],lastBlockId:0,answer:[]}},mounted:function(){this.init()},methods:{init:function(){for(var t=[],e=[],n=0;n<p;++n){t.push([]);for(var c=0;c<v;++c){var o=this.generateBlock(n,c);t[n].push(o),e.push(o)}}this.cells=t,this.blocks=e,this.__checkCrush()},playAgain:function(){this.init()},generateBlock:function(t,e){var n={id:++this.lastBlockId,x:t,y:e,color:Math.floor(7*Math.random())};return n},onTouchStart:function(t,e){if(!this.animating){var n=e.touches[0];this._touchStartBlockId=t.id,this._touchStartBlockX=n.clientX,this._touchStartBlockY=n.clientY}},onTouchMove:function(t,e){if(!this.animating&&this._touchStartBlockId===t.id){var n=e.touches[0],c=n.clientX-this._touchStartBlockX,o=n.clientY-this._touchStartBlockY,r=30;Math.abs(c)>r&&Math.abs(o)<r/2?(c<0?this.exchangeBlock(t,"left"):this.exchangeBlock(t,"right"),this._touchStartBlockId=null):Math.abs(c)<r/2&&Math.abs(o)>r?(o<0?this.exchangeBlock(t,"up"):this.exchangeBlock(t,"down"),this._touchStartBlockId=null):Math.abs(c)>r/2&&Math.abs(o)>r/2&&(this._touchStartBlockId=null)}},exchangeBlock:function(t,e){var n,c,o=this,r=t.x,s=t.y;switch(e){case"left":n=r-1,c=s;break;case"right":n=r+1,c=s;break;case"up":n=r,c=s+1;break;case"down":n=r,c=s-1;break}n<0||n>=p||c<0||c>=v||(console.log(r,s,e,n,c),this.__exchageBlocks(r,s,n,c).then((function(){o.__checkCrush()||o.__exchageBlocks(r,s,n,c)})))},__exchageBlocks:function(t,e,n,c){var o=this,r=this.cells[t][e],s=this.cells[n][c];return r.x=n,r.y=c,s.x=t,s.y=e,this.cells[t][e]=s,this.cells[n][c]=r,this.animating=!0,new Promise((function(t){setTimeout((function(){o.animating=!1,t()}),300)}))},__checkCrush:function(){var t=this,e=[];return this.blocks.forEach((function(n){e.indexOf(n)<0&&t.__checkBlockCrush(n)&&e.push(n)})),e.length?(this.__crushBlocks(e),!0):(this.answer=this.__findAnswer(),this.answer&&this.answer.length||this.unsolvable(),!1)},__checkBlockCrush:function(t){var e=t.x,n=t.y,c=t.color;return e>1&&this.cells[e-2][n].color===c&&this.cells[e-1][n].color===c||(e>0&&e<p-1&&this.cells[e-1][n].color===c&&this.cells[e+1][n].color===c||(e<p-2&&this.cells[e+1][n].color===c&&this.cells[e+2][n].color===c||(n>1&&this.cells[e][n-2].color===c&&this.cells[e][n-1].color===c||(n>0&&n<v-1&&this.cells[e][n-1].color===c&&this.cells[e][n+1].color===c||n<v-2&&this.cells[e][n+1].color===c&&this.cells[e][n+2].color===c))))},__crushBlocks:function(t){var e=this;this.animating=!0,Promise.all(t.map((function(t){return e.__crushBlock(t).then((function(){e.cells[t.x][t.y]={},e.blocks.splice(e.blocks.indexOf(t),1)}))}))).then((function(){e.addScore(t.length),e.__fall(t).then((function(){e.animating=!1,e.__checkCrush()}))})),this.blocks.splice()},__crushBlock:function(t){return console.log("__crushBlock",t.x,t.y),t.status="crushing",new Promise((function(t){setTimeout(t,300)}))},__fall:function(t){var e=this;this.animating=!0;var n={};return t.sort((function(t,e){return(t.y-e.y)*p+(t.x-e.x)})).map((function(t){return n[t.x]||(n[t.x]=0),e.__findSubstituteBlock(t,n[t.x]++)})).forEach((function(t){t.falling=n[t.x]})),Promise.all(this.blocks.filter((function(t){return t.falling})).map((function(t){return e.__moveBlock(t,t.x,t.y-t.falling).then((function(){t.falling=0}))})))},__findSubstituteBlock:function(t,e){var n=this.generateBlock(t.x,v+e);this.blocks.push(n);for(var c=t.y+1;c<v;++c)this.cells[t.x][c].id&&(this.cells[t.x][c].falling=this.cells[t.x][c].falling?this.cells[t.x][c].falling+1:1);return n},__moveBlock:function(t,e,n){var c=this;return this.cells[t.x]&&this.cells[t.x][t.y]&&(this.cells[t.x][t.y]={}),setTimeout((function(){c.cells[e][n]=t,t.x=e,t.y=n}),100),new Promise((function(t){setTimeout(t,300)}))},__findAnswer:function(){for(var t=this,e=function(e,n,c,o){var r=function(e,n,c,o){var r=t.cells[e][n],s=t.cells[c][o];r.x=c,r.y=o,s.x=e,s.y=n,t.cells[e][n]=s,t.cells[c][o]=r};r(e,n,c,o);var s=t.__checkBlockCrush(t.cells[e][n])||t.__checkBlockCrush(t.cells[c][o]);return r(e,n,c,o),s},n=0;n<this.blocks.length;++n){var c=this.blocks[n],o=c.x,r=c.y;if(o<p-1&&e(o,r,o+1,r))return[o,r,o+1,r];if(r<v-1&&e(o,r,o,r+1))return[o,r,o,r+1]}return[]},addScore:function(t){this.$emit("addScore",t)},unsolvable:function(){this.$emit("unsolvable")}}},k=g,b=(n("688e"),Object(s["a"])(k,d,_,!1,null,"0041a87b",null)),m=b.exports,x={name:"Home",components:{TrigleCurshGame:m},data:function(){return{score:0}},methods:{addScore:function(t){console.log("addScore",t),this.score+=t},unsolvable:function(){alert("There is no answer! Please play again!")},playAgain:function(){this.score=0,this.$refs.game.playAgain()}}},y=x,B=(n("4db9"),Object(s["a"])(y,h,f,!1,null,"1014e27f",null)),w=B.exports;c["a"].use(u["a"]);var S=[{path:"/",name:"Home",component:w}],C=new u["a"]({routes:S}),O=C;n("499a");c["a"].config.productionTip=!1,new c["a"]({router:O,render:function(t){return t(a)}}).$mount("#app")},"5c0b":function(t,e,n){"use strict";n("9c0c")},"688e":function(t,e,n){"use strict";n("d2ec")},"9c0c":function(t,e,n){},d2ec:function(t,e,n){}});
//# sourceMappingURL=app.js.map