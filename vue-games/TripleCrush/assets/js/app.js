(function(t){function n(n){for(var c,i,r=n[0],l=n[1],a=n[2],h=0,f=[];h<r.length;h++)i=r[h],Object.prototype.hasOwnProperty.call(o,i)&&o[i]&&f.push(o[i][0]),o[i]=0;for(c in l)Object.prototype.hasOwnProperty.call(l,c)&&(t[c]=l[c]);u&&u(n);while(f.length)f.shift()();return s.push.apply(s,a||[]),e()}function e(){for(var t,n=0;n<s.length;n++){for(var e=s[n],c=!0,r=1;r<e.length;r++){var l=e[r];0!==o[l]&&(c=!1)}c&&(s.splice(n--,1),t=i(i.s=e[0]))}return t}var c={},o={app:0},s=[];function i(n){if(c[n])return c[n].exports;var e=c[n]={i:n,l:!1,exports:{}};return t[n].call(e.exports,e,e.exports,i),e.l=!0,e.exports}i.m=t,i.c=c,i.d=function(t,n,e){i.o(t,n)||Object.defineProperty(t,n,{enumerable:!0,get:e})},i.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,n){if(1&n&&(t=i(t)),8&n)return t;if(4&n&&"object"===typeof t&&t&&t.__esModule)return t;var e=Object.create(null);if(i.r(e),Object.defineProperty(e,"default",{enumerable:!0,value:t}),2&n&&"string"!=typeof t)for(var c in t)i.d(e,c,function(n){return t[n]}.bind(null,c));return e},i.n=function(t){var n=t&&t.__esModule?function(){return t["default"]}:function(){return t};return i.d(n,"a",n),n},i.o=function(t,n){return Object.prototype.hasOwnProperty.call(t,n)},i.p="";var r=window["webpackJsonp"]=window["webpackJsonp"]||[],l=r.push.bind(r);r.push=n,r=r.slice();for(var a=0;a<r.length;a++)n(r[a]);var u=l;s.push([0,"chunk-vendors"]),e()})({0:function(t,n,e){t.exports=e("56d7")},"11ad":function(t,n,e){},"4db9":function(t,n,e){"use strict";e("11ad")},"56d7":function(t,n,e){"use strict";e.r(n);e("e260"),e("e6cf"),e("cca6"),e("a79d");var c=e("2b0e"),o=function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("div",{attrs:{id:"app"}},[e("router-view")],1)},s=[],i=(e("5c0b"),e("2877")),r={},l=Object(i["a"])(r,o,s,!1,null,null,null),a=l.exports,u=e("8c4f"),h=function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("div",{staticClass:"home"},[e("div",{staticClass:"title"},[t._v("Trigle Crush")]),e("div",{staticClass:"score"},[t._v("Score: "+t._s(t.score))]),e("TrigleCurshGame",{ref:"game",on:{addScore:t.addScore,unsolvable:t.unsolvable}}),e("div",{staticClass:"btn-again",on:{click:t.playAgain}},[t._v("Play Again")])],1)},f=[],_=function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("div",{staticClass:"trigle-crush-game"},[e("div",{staticClass:"blocks",on:{touchmove:t.onTouchMove,mousemove:t.onMouseMove}},[t._l(t.blocks,(function(n){return[e("div",{key:n.id,staticClass:"block",class:[n.status,!t.animating&&(t.answer[0]==n.x&&t.answer[1]==n.y||t.answer[2]==n.x&&t.answer[3]==n.y)?"answer":""],attrs:{x:n.x,y:n.y,color:n.color},on:{touchstart:function(e){var c=arguments.length,o=Array(c);while(c--)o[c]=arguments[c];return t.onTouchStart.apply(void 0,[n].concat(o))},mousedown:function(e){var c=arguments.length,o=Array(c);while(c--)o[c]=arguments[c];return t.onMouseDown.apply(void 0,[n].concat(o))}}})]}))],2)])},d=[],k=(e("d3b7"),e("159b"),e("3ca3"),e("ddb0"),e("d81d"),e("a434"),e("4e82"),e("4de4"),7),v=7,p={name:"TrigleCurshGame",props:{},data:function(){return{animating:!1,cells:[],blocks:[],lastBlockId:0,answer:[]}},mounted:function(){this.init()},methods:{init:function(){for(var t=[],n=[],e=0;e<k;++e){t.push([]);for(var c=0;c<v;++c){var o=this.generateBlock(e,c);t[e].push(o),n.push(o)}}this.cells=t,this.blocks=n,this.__checkCrush()},playAgain:function(){this.init()},generateBlock:function(t,n){var e={id:++this.lastBlockId,x:t,y:n,color:Math.floor(7*Math.random())};return e},onTouchStart:function(t,n){if(!this.animating){var e=n.touches[0];this._touchStartBlock=t,this._touchStartBlockX=e.clientX,this._touchStartBlockY=e.clientY}},onTouchMove:function(t){if(!this.animating&&this._touchStartBlock){var n=t.touches[0];this.__checkExchangeBlock(this._touchStartBlock,n)}},onMouseDown:function(t,n){this.animating||(this._touchStartBlock=t,this._touchStartBlockX=n.clientX,this._touchStartBlockY=n.clientY)},onMouseMove:function(t){this.animating||this._touchStartBlock&&this.__checkExchangeBlock(this._touchStartBlock,t)},__checkExchangeBlock:function(t,n){var e=n.clientX-this._touchStartBlockX,c=n.clientY-this._touchStartBlockY,o=30;Math.abs(e)>o&&Math.abs(c)<o/2?(e<0?this.exchangeBlock(t,"left"):this.exchangeBlock(t,"right"),this._touchStartBlock=null):Math.abs(e)<o/2&&Math.abs(c)>o?(c<0?this.exchangeBlock(t,"up"):this.exchangeBlock(t,"down"),this._touchStartBlock=null):Math.abs(e)>o/2&&Math.abs(c)>o/2&&(this._touchStartBlock=null)},exchangeBlock:function(t,n){var e,c,o=this,s=t.x,i=t.y;switch(n){case"left":e=s-1,c=i;break;case"right":e=s+1,c=i;break;case"up":e=s,c=i+1;break;case"down":e=s,c=i-1;break}e<0||e>=k||c<0||c>=v||(console.log(s,i,n,e,c),this.__exchageBlocks(s,i,e,c).then((function(){o.__checkCrush()||o.__exchageBlocks(s,i,e,c)})))},__exchageBlocks:function(t,n,e,c){var o=this,s=this.cells[t][n],i=this.cells[e][c];return s.x=e,s.y=c,i.x=t,i.y=n,this.cells[t][n]=i,this.cells[e][c]=s,this.animating=!0,new Promise((function(t){setTimeout((function(){o.animating=!1,t()}),300)}))},__checkCrush:function(){var t=this,n=[];return this.blocks.forEach((function(e){n.indexOf(e)<0&&t.__checkBlockCrush(e)&&n.push(e)})),n.length?(this.__crushBlocks(n),!0):(this.answer=this.__findAnswer(),this.answer&&this.answer.length||this.unsolvable(),!1)},__checkBlockCrush:function(t){var n=t.x,e=t.y,c=t.color;return n>1&&this.cells[n-2][e].color===c&&this.cells[n-1][e].color===c||(n>0&&n<k-1&&this.cells[n-1][e].color===c&&this.cells[n+1][e].color===c||(n<k-2&&this.cells[n+1][e].color===c&&this.cells[n+2][e].color===c||(e>1&&this.cells[n][e-2].color===c&&this.cells[n][e-1].color===c||(e>0&&e<v-1&&this.cells[n][e-1].color===c&&this.cells[n][e+1].color===c||e<v-2&&this.cells[n][e+1].color===c&&this.cells[n][e+2].color===c))))},__crushBlocks:function(t){var n=this;this.animating=!0,Promise.all(t.map((function(t){return n.__crushBlock(t).then((function(){n.cells[t.x][t.y]={},n.blocks.splice(n.blocks.indexOf(t),1)}))}))).then((function(){n.addScore(t.length),n.__fall(t).then((function(){n.animating=!1,n.__checkCrush()}))})),this.blocks.splice()},__crushBlock:function(t){return console.log("__crushBlock",t.x,t.y),t.status="crushing",new Promise((function(t){setTimeout(t,300)}))},__fall:function(t){var n=this;this.animating=!0;var e={};return t.sort((function(t,n){return(t.y-n.y)*k+(t.x-n.x)})).map((function(t){return e[t.x]||(e[t.x]=0),n.__findSubstituteBlock(t,e[t.x]++)})).forEach((function(t){t.falling=e[t.x]})),Promise.all(this.blocks.filter((function(t){return t.falling})).map((function(t){return n.__moveBlock(t,t.x,t.y-t.falling).then((function(){t.falling=0}))})))},__findSubstituteBlock:function(t,n){var e=this.generateBlock(t.x,v+n);this.blocks.push(e);for(var c=t.y+1;c<v;++c)this.cells[t.x][c].id&&(this.cells[t.x][c].falling=this.cells[t.x][c].falling?this.cells[t.x][c].falling+1:1);return e},__moveBlock:function(t,n,e){var c=this;return this.cells[t.x]&&this.cells[t.x][t.y]&&(this.cells[t.x][t.y]={}),setTimeout((function(){c.cells[n][e]=t,t.x=n,t.y=e}),100),new Promise((function(t){setTimeout(t,300)}))},__findAnswer:function(){for(var t=this,n=function(n,e,c,o){var s=function(n,e,c,o){var s=t.cells[n][e],i=t.cells[c][o];s.x=c,s.y=o,i.x=n,i.y=e,t.cells[n][e]=i,t.cells[c][o]=s};s(n,e,c,o);var i=t.__checkBlockCrush(t.cells[n][e])||t.__checkBlockCrush(t.cells[c][o]);return s(n,e,c,o),i},e=0;e<this.blocks.length;++e){var c=this.blocks[e],o=c.x,s=c.y;if(o<k-1&&n(o,s,o+1,s))return[o,s,o+1,s];if(s<v-1&&n(o,s,o,s+1))return[o,s,o,s+1]}return[]},addScore:function(t){this.$emit("addScore",t)},unsolvable:function(){this.$emit("unsolvable")}}},g=p,b=(e("a7df"),Object(i["a"])(g,_,d,!1,null,"77468fe2",null)),m=b.exports,x={name:"Home",components:{TrigleCurshGame:m},data:function(){return{score:0}},methods:{addScore:function(t){console.log("addScore",t),this.score+=t},unsolvable:function(){alert("There is no answer! Please play again!")},playAgain:function(){this.score=0,this.$refs.game.playAgain()}}},y=x,B=(e("4db9"),Object(i["a"])(y,h,f,!1,null,"1014e27f",null)),w=B.exports;c["a"].use(u["a"]);var S=[{path:"/",name:"Home",component:w}],M=new u["a"]({routes:S}),C=M;e("499a");c["a"].config.productionTip=!1,new c["a"]({router:C,render:function(t){return t(a)}}).$mount("#app")},"5c0b":function(t,n,e){"use strict";e("9c0c")},"9c0c":function(t,n,e){},a77f:function(t,n,e){},a7df:function(t,n,e){"use strict";e("a77f")}});
//# sourceMappingURL=app.js.map